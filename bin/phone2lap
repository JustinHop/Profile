#!/bin/zsh

#
#   This is to move pics from the phone to the laptop
#

SRC=/media/disk/DCIM/
DST=/home/justin/Pictures

NEWDATE=`date +%F`

if [ ! -d "${DST}/${NEWDATE}" ]; then
	mkdir -p "${DST}/${NEWDATE}"
fi


for SOURCE in $SRC/*(-/) ; do 

    TXLIST="${SRC}/transfered_list"

    if [ ! -w $TXLIST ]; then
        echo "$TXLIST not writable"
        exit 1;
    fi

    cd $SOURCE || exit 1

    if [ -f $TXLIST ]; then
        tar -cpf - -X $TXLIST *.JPG | ( cd "$DST/$NEWDATE" ; tar -xvpf - ) || exit 1
    else
        tar -cpf - *.JPG | ( cd "$DST/$NEWDATE" ; tar -xvpf - ) || exit 1
    fi

    cd "$DST/$NEWDATE" || exit 1

    for PIC in *JPG ; do
	    echo ${PIC:t} >> $TXLIST || exit 1
    done

done

