#!/bin/bash

TEMPFILE=~/tmp/screens$$
trap "rm -f $TEMPFILE" 0 1 2 5 15


#ACTIVE_SCREENS=$(screen -ls | awk '/tached/ { print $1}' | sed 's/\./ /' | sort)
SCREEN_ATTACH_ARGS="-A -d -r"
SCREEN_NEW_ARGS='-A -S $sname -dm $pjob'

while true; do
    ACTIVE_SCREENS=$(screen -ls | awk '/tached/ { print $1" "$2}' | sort)

    dialog --backtitle "Screen sessions on $(hostname)" \
        --stderr --clear \
        --menu "Sessions:" 0 0 0 $ACTIVE_SCREENS New "Create new session" 2> $TEMPFILE

    RETVAL=$?
    CHOICE=$(cat $TEMPFILE)

    case $RETVAL in
        0)
            if [ "$CHOICE" == "New" ]; then
                dialog --inputbox "Session Name:" 0 0 2> $TEMPFILE
                NAME=$(cat $TEMPFILE)
                screen -A -S $NAME -dm
            else
                screen -A -d -r $CHOICE
            fi
            ;;
        *)
            exit
            ;;
    esac

done
